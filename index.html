<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWEZA TV | Settings Mode</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --main: #e50914; --bg: #0b0b0b; --card: #1a1a1a; }
        body, html { background-color: var(--bg); color: white; font-family: sans-serif; margin: 0; padding: 0; height: 100vh; overflow: hidden; }
        
        /* Ø³Û•Ø±Ù¾Û•Ú•Û• */
        header { 
            height: 65px; background: #000; display: flex; justify-content: space-between; 
            align-items: center; padding: 0 20px; border-bottom: 2px solid var(--main);
            position: relative; z-index: 100;
        }
        .logo { font-size: 24px; font-weight: bold; color: var(--main); }
        .settings-btn { background: #222; color: white; border: 1px solid #444; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .settings-btn:hover { background: var(--main); border-color: white; }

        /* Ø¨Û•Ø´ÛŒ Ú¤ÛŒØ¯ÛŒÛ† */
        .player-container { width: 100%; height: 45vh; background: #000; display: flex; justify-content: center; border-bottom: 1px solid #222; }
        video { width: 100%; height: 100%; background: #000; }

        /* Ù„ÛŒØ³ØªÛŒ Ú©Û•Ù†Ø§ÚµÛ•Ú©Ø§Ù† */
        .content { 
            height: calc(55vh - 65px); overflow-y: auto; padding: 20px; 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px;
        }
        
        .card { 
            background: var(--card); border-radius: 10px; padding: 15px; 
            text-align: center; cursor: pointer; border: 1px solid #333; transition: 0.3s;
        }
        .card:hover { border-color: var(--main); transform: scale(1.05); }
        .card img { width: 50px; height: 50px; object-fit: contain; margin-bottom: 8px; border-radius: 5px; }
        .card span { font-size: 12px; font-weight: bold; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* Ù…Û†Ø¯Ø§ÚµÛŒ Ú•ÛÚ©Ø®Ø³ØªÙ† */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: #1a1a1a; padding: 25px; border-radius: 15px; width: 90%; max-width: 500px; border: 1px solid #444; text-align: center; }
        textarea { width: 100%; height: 120px; background: #000; color: #0f0; border: 1px solid #333; border-radius: 8px; padding: 10px; margin: 15px 0; box-sizing: border-box; resize: none; }
        .modal-btn { background: var(--main); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; margin-bottom: 10px; }
        .close-btn { background: #333; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; width: 100%; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: var(--main); border-radius: 10px; }
    </style>
</head>
<body>

<header>
    <div class="logo">AWEZA TV</div>
    <button class="settings-btn" onclick="toggleModal()">âš™ï¸ Ú•ÛÚ©Ø®Ø³ØªÙ†</button>
</header>

<div class="player-container">
    <video id="videoPlayer" controls></video>
</div>

<div class="content" id="list">
    <div style="grid-column: 1/-1; text-align: center; color: #555; margin-top: 50px;">Ø¨Û† Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ø¯Ù† Ú©Ù„ÛŒÚ© Ù„Û• Ú•ÛÚ©Ø®Ø³ØªÙ† Ø¨Ú©Û• Ùˆ ÙØ§ÛŒÙ„ÛÚ© Ø¨Ø§Ø±Ø¨Ú©Û•.</div>
</div>

<div id="settingsModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0; color:var(--main)">Ú•ÛÚ©Ø®Ø³ØªÙ†ÛŒ Ù„ÛŒØ³Øª</h3>
        
        <button class="modal-btn" onclick="document.getElementById('fileIn').click()">ğŸ“ Ù‡Û•ÚµØ¨Ú˜Ø§Ø±Ø¯Ù†ÛŒ ÙØ§ÛŒÙ„ÛŒ M3U</button>
        <input type="file" id="fileIn" accept=".m3u,.txt" style="display:none" onchange="handleFile(event)">
        
        <p style="font-size: 12px; color: #888;">ÛŒØ§Ù† Ú©Û†Ø¯Û•Ú©Û• Ù„ÛØ±Û• Ù¾Û•ÛŒØ³ Ø¨Ú©Û•:</p>
        
        <textarea id="m3uText" placeholder="#EXTM3U..."></textarea>
        <button class="modal-btn" onclick="processText()">âœ… Ø¬ÛÚ¯ÛŒØ±Ú©Ø±Ø¯Ù†ÛŒ Ø¯Û•Ù‚</button>
        
        <hr style="border: 0.5px solid #333; margin: 15px 0;">
        <button class="close-btn" onclick="toggleModal()">Ø¯Ø§Ø®Ø³ØªÙ†</button>
    </div>
</div>

<script>
    const video = document.getElementById('videoPlayer');
    const hls = new Hls();
    const listContainer = document.getElementById('list');
    const modal = document.getElementById('settingsModal');

    function toggleModal() {
        modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
    }

    // Ú†Ø§Ø±Û•Ø³Û•Ø±ÛŒ Ø¯Û•Ù‚
    function processText() {
        const text = document.getElementById('m3uText').value;
        parseAndRender(text);
        toggleModal();
    }

    // Ú†Ø§Ø±Û•Ø³Û•Ø±ÛŒ ÙØ§ÛŒÙ„
    function handleFile(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
            parseAndRender(ev.target.result);
            toggleModal();
        };
        reader.readAsText(file);
    }

    function parseAndRender(data) {
        listContainer.innerHTML = '';
        if (!data.includes('http')) return;

        const lines = data.split('\n');
        let name = '', logo = '';

        lines.forEach((line) => {
            line = line.trim();
            if (line.startsWith('#EXTINF:')) {
                const logoMatch = line.match(/tvg-logo="([^"]+)"/);
                logo = logoMatch ? logoMatch[1] : '';
                name = line.split(',').pop() || 'Channel';
            } else if (line.startsWith('http')) {
                const currentUrl = line;
                const currentName = name || "Channel";
                const currentLogo = logo || 'https://cdn-icons-png.flaticon.com/512/716/716429.png';

                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <img src="${currentLogo}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/716/716429.png'">
                    <span>${currentName}</span>
                `;
                
                div.onclick = () => {
                    if (Hls.isSupported()) {
                        hls.loadSource(currentUrl);
                        hls.attachMedia(video);
                        hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
                    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                        video.src = currentUrl;
                        video.play();
                    }
                    window.scrollTo({top: 0, behavior: 'smooth'});
                };
                listContainer.appendChild(div);
                name = ''; logo = '';
            }
        });
    }
</script>
</body>
</html>
